<div class="max-w-3xl mx-auto p-6 pt-16 md:pt-6"
     data-controller="complete-all"
     data-complete-all-list-id-value="<%= todo_list.id %>">

  <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-3">
    <div>
      <h2 class="text-2xl font-bold text-gray-800">
        <%= todo_list.name %>
        <span class="text-sm font-normal text-gray-500" id="item_count">(<%= todo_list.todo_items.count %>)</span>
      </h2>
    </div>

    <%= render "complete_all_button", todo_list: todo_list %>
  </div>

  <div class="mb-6" id="new_item_form">
    <%= form_with model: [todo_list, TodoItem.new],
        url: todo_list_todo_items_path(todo_list),
        class: "flex gap-2" do |f| %>
      <%= f.text_field :description, placeholder: "Add a new item...",
          class: "flex-1 min-w-0 border border-gray-300 rounded px-4 py-2 text-sm
                 focus:outline-none focus:ring-2 focus:ring-primary
                 focus:border-transparent" %>
      <%= f.submit "Add",
          class: "bg-primary hover:bg-primary/80 text-white px-6 py-2
                 rounded text-sm font-medium cursor-pointer" %>
    <% end %>
  </div>

  <% per_page = 50 %>
  <% items = todo_list.todo_items.order(created_at: :desc).limit(per_page + 1).to_a %>
  <% has_next = items.length > per_page %>
  <% display_items = items.first(per_page) %>
  <% next_cursor = display_items.last&.id %>

  <div id="todo_items" class="space-y-2">
    <%= render partial: "todo_items/todo_item", collection: display_items %>

    <% if has_next %>
      <%= turbo_frame_tag "todo_items_page_#{next_cursor}",
          src: todo_list_todo_items_path(todo_list, after_id: next_cursor),
          loading: :lazy do %>
        <div class="p-4 text-center text-gray-400 text-sm">Loading more...</div>
      <% end %>
    <% end %>
  </div>
</div>
